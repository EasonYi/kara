var sj_globalBindingId=1;var sj_commands={};function bindNodes(b,a){var g=$(b).attr("bind");if(g==undefined){bindAttributes(b,a);$(b).children().each(function(){if($(this).data("expanded-id")==undefined){bindNodes(this,a)}})}else{var f=bindValue(g,a);if(f instanceof Array){$(b).hide();var e=$(b).data("binding-id");if(e==undefined){e=sj_globalBindingId++;$(b).data("binding-id",e)}var d=[];var c=$(b).prev();while(c.data("expanded-id")==e){d.push(c);c=c.prev()}$.each(f,function(h,i){var j=d.pop()||$(b).clone();j.removeAttr("bind");bindNodes(j.get(0),i);if(j.data("expanded-id")==undefined){j.data("expanded-id",e);j.insertBefore(b);j.show()}});$.each(d,function(h,i){i.remove()})}else{bindAttributes(b,f);$(b).children().each(function(){bindNodes(this,f)})}}}function bindAttributes(e,f){var a=e.attributes;for(var d=0;d<a.length;d++){var c=a[d].nodeName;if(c.indexOf("bind-")==0){var b=c.slice(5,c.length);var g=bindValue(a[d].nodeValue,f);if(g!=undefined){g=g.toString().replace(/&nbsp;/g,"\u00a0")}if(b=="text"){if($(e).text()!=g){$(e).text(g)}}else{if(b=="html"){if($(e).html()!=g){$(e).html(g)}}else{if($(e).attr(b)!=g){$(e).attr(b,g)}}}}}}function bindValue(e,c){var b=e.split(":");if(b.length>1){var d=b[0];switch(d){case"if":return command_if(b,c)}var a=sj_commands[d];if(a!=undefined){return a(b,c)}return undefined}return bindProperties(e,c)}function bindProperties(d,c){if(d[0]!="@"){return d}var b=d.slice(1).split(".");var e=c;for(var a=0;a<b.length;a++){e=e[b[a]];if(e==undefined){return undefined}}return e}function command_if(a,b){if(a.length<3){return undefined}var c=bindProperties(a[1],b);if((typeof c=="boolean"&&c)||(typeof c=="number"&&parseInt(c)!=0)||(typeof c=="string"&&c.toUpperCase()=="TRUE")){return bindProperties(a[2],b)}if(a.length>=4){return bindProperties(a[3],b)}return undefined}function bind(a,b){a.each(function(){bindNodes(this,b)});$(document).triggerHandler("binding-complete")}function executeData(c,d){var a=c.attr("data-use");switch(a){case"bind":var b=c.attr("data-bind");if(b!=undefined){bind($(b),d)}else{bind(c,d)}break}}function fetch(c){var b=0;var a=c.attr("data-use");switch(a){case"bind":$.ajax({url:c.attr("data-url"),context:c,dataType:c.attr("data-type")||"json"}).done(function(e){executeData($(this),e);var d=c.attr("data-interval");if(d!=undefined){setTimeout(function(){fetch(c)},parseInt(d)*1000)}}).fail(function(){b=b+1;setTimeout(function(){fetch(c)},10000*b)});break;case"modal":c.on("click",function(){c.next(".modal").modal({remote:c.attr("data-url")})});break}}$(function(){$("[data-url]").each(function(){var a=$(this);fetch(a)})});var roundtripListeners=[];var roundtripVersion=0;function onRoundtrip(a){roundtripListeners=roundtripListeners.concat(a)}$(function(){function b(j,f,h){if(h==undefined){return}var m=h.split(",");for(var k=0;k<m.length;k++){var e=m[k].trim();var g=e.split("=");var l;var d;if(g.length>1){l=g[1];d=g[0]}else{l=e;d=e}if(l=="value"){j[d]=f.val()}else{j[d]=f.attr(l)}}}function a(e,f,d){roundtripListeners.forEach(function(g){g.roundtripBegan(++roundtripVersion)});$.ajax({url:e.attr("send-url"),cache:false,context:e,type:e.attr("send-method")||"GET",dataType:"json",data:f}).done(function(h){executeData(e,h);var g=e.attr("send-fetch");if(g!=undefined){fetch($(g))}if(d!=undefined){d(e,h)}roundtripListeners.forEach(function(i){i.roundtripDone(roundtripVersion)})}).fail(function(g){roundtripListeners.forEach(function(h){h.roundtripFailed(roundtripVersion)})})}var c=function(f){var d={};b(d,$(this),$(this).attr("send-values"));a($(this),d);f.preventDefault()};$(document).on("click","a[send-url]",c);$(document).on("change","input[send-url]",c);$(document).on("keyup","input[send-url]",c);$(document).on("submit","form[send-url]",function(f){var d=$(this).serialize();a($(this),d,function(e,g){e.each(function(){this.reset()})});f.preventDefault()})});